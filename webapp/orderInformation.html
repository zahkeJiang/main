<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<title>订单详情</title>
	<link href="css/base.css" rel="stylesheet" type="text/css"/>
	<!-- <link href="css/order_information.css" rel="stylesheet" type="text/css"/> -->
</head>
<style type="text/css">
body{
	background: #4ea0ff;
	color: #999;
}
/*订单进度*/
.contentBox{
	border-radius: 10px;
	background: #f6f1f1;
	margin: 10px 16px;
}
.shedule-tiele{
	color: #555;
	height: 40px;
	padding:0 10px;
	line-height: 40px;
}
.chedule-content{
	padding: 10px;
	height: 60px;
	/*height: 60px;*/
	display: flex;
	align-items: center;
	font-size: 20px;
}
/*.chedule-content>div{
	flex: 1;
	text-align: center;
}
.progress_pic_style{
	height: 40px;
	display: flex;
	align-items: center;
}
.progress_pic_style i{
	height: 1px;
	background: #ccc;
	width: 100%;
}
.chedule-content i.None{
	background: #f6f1f1;
}
.chedule-content h2{
	font-size: 14px;
	height: 20px;
	line-height: 20px;
	font-weight: bold;
}
.chedule-content p{
	font-size: 14px;
	line-height: 20px;
}*/
.shedule-hint{
	padding:0 10px;
	height: 40px;
	font-size: 12px;
	display: flex;
	align-items: center;
	justify-content: space-between;
}
.shedule-hint-delivery{
	font-size: 12px;
	width: 68px;
	text-align: center;
	display: none;
	height: 32px;
	line-height: 32px;
	color: #fff;
	background: #4ea0ff;
	border-radius: 8px;
}
/*用户信息*/
.user{
	padding: 10px;
}
.user p{
	font-size: 14px;
	margin-top: 8px;
}
/*订单框*/
.order-name{
	height: 40px;
	line-height: 40px;
	border-bottom: 1px solid #ddd;
	padding:0 10px;
}
.order-container{
	padding: 10px;
	display: flex;
}
/*.order-container img{
	min-width: 64px;
}*/
.order-container div{
	margin-left: 10px;
}
.order-container div p.order-description{
	font-size: 14px;
}
.order-container div p.order-mode{
	margin-top:8px;
	font-size: 14px;
}
/*订单编号*/
.ordernumber{
	padding: 10px;
	line-height: 40px;
	font-size: 14px;
}
.ordernumber p.order-time{
	margin-top: 8px;
}
/*金额*/
.price{
	/*margin-bottom:58px;*/
	position: relative;
}
.price-row{
	display: flex;
	justify-content: space-between;
	margin:0 10px;
	font-size: 14px;
}
.price-row1{
	padding-top:10px;
	padding-bottom:8px;
}
.price-row{
	padding-bottom:10px;
}
.pay{
	text-align: right;
	margin:0 10px;
	height: 40px;
	line-height: 40px;
	border-top: 1px solid #ddd;
}
/*footer*/
.footer{
	position: fixed;
	width: 100%;
	bottom: 0;
	height: 48px;
	background: #f6f1f1;
	display: none;
}
.footer div{
	display: none;
	float: right;
	text-align: center;
	width: 80px;
	height: 32px;
	line-height: 32px;
	margin: 6px 16px 6px 0;
	border-radius: 2px;
	border:1px solid #999;
}
.footer div.toPay{
	border:1px solid #4ea0ff;
}
.footer div.assess{
	border:1px solid #4ea0ff;
}
/*.footerhint{
	display: none;
	margin-bottom: 10px;
	color: white;
	font-size: 14px;
	text-align: center;
}
.footerhint p{
	font-size: 14px;
	line-height: 20px;
}*/
</style>
<body>
<!-- 订单进度 -->
	<div class="shedule contentBox">	
		<p class="shedule-tiele">订单进度</p>
		<div class="chedule-content">
			<!-- <div class="chedule-progress">
				<div class="progress_pic_style">
					<i class="None"></i>
					<img id="cartoon1" src="images/waite.png" height="12px" width="12px">
					<i></i>
				</div>
				<h2>提交订单</h2>
				<p class="submit_data">1</p>
				<p class="submit_time">1</p>
			</div>
			<div class="chedule-progress">
				<div class="progress_pic_style">
					<i></i>
					<img id="cartoon4" src="images/waite.png" height="12px" width="12px">
					<i></i>
				</div>
				<h2>已付款</h2>
				<p class="submit_data">2</p>
				<p class="submit_time">2</p>
			</div>
			<div class="chedule-progress">
				<div class="progress_pic_style">
					<i></i>
					<img id="cartoon4" src="images/waite.png" height="12px" width="12px">
					<i></i>
				</div>
				<h2>已完成</h2>
				<p class="submit_data">3</p>
				<p class="submit_time">3</p>
			</div>
			<div class="chedule-progress">
				<div class="progress_pic_style">
					<i></i>
					<img id="cartoon4" src="images/waite.png" height="12px" width="12px">
					<i class="None"></i>
				</div>
				<h2>已取消</h2>
				<p class="submit_data">4</p>
				<p class="submit_time">4</p>
			</div> -->
		</div>
		
		<div class="shedule-hint">
			<p class="shedule-hint-text"></p>
			<div class="shedule-hint-delivery">确认送达</div>
		</div>
	</div>
<!-- 用户信息 -->
	<div class="user contentBox">
		<p class="user-name"></p>
		<p class="user-tel"></p>
		<!-- <p class="user-address">地址：北京市朝阳区北四环东路</p> -->
	</div>
<!-- 订单框 -->
	<div class='order contentBox'>
		<p class="order-name"></p>
		<div class='order-container'>
			<!-- <img  height='48px' width='64px' id="order-image"> -->
			<div>
				<p class='order-description'></p>
				<p class='order-mode'></p>
			</div>
		</div>
	</div>
<!-- 订单号 -->
	<div class="ordernumber contentBox">
		<p class="order-number"></p>
		<p class="order-time"></p>
	</div>
<!-- 金额 -->
	<div class="price contentBox">
		<div class="price-row price-row1">
			<span>商品总额</span>
			<span class="order-price"></span><!-- 原价 -->
		</div>
		<div class="price-row price-row2">
			<span>- 优惠</span>
			<span class="price-coupon"></span><!-- 优惠券 -->
		</div>
		<div class="pay">
			<span>实付款：</span>
			<span class="price-pay"></span><!-- 实际付款 -->
		</div>
	</div>
<!-- footer -->
<!-- 	<div class="footerhint">
		<p>交易完成；</p><p>欢迎您再次使用；</p><p>北京漂洋过海，一切因你而在！</p>
	</div> -->
	<div class="footer">
		<div class='toPay'>去支付</div>
		<div class='cancel'>取消订单</div>
		<div class="assess">评价</div>
	</div>
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<script src="js/jquery.cookie.js" type="text/javascript"></script>
<!--<script type="text/javascript" src="js/isWeiXin.js"></script>-->
<!-- <script type="text/javascript" src="js/order_information.js"></script> -->
<script type="text/javascript">
var ordernumber = "";
function ShowMessage() 
{ 
  	var thisURL = document.URL;    
   	var getval = thisURL.split('?')[1];  
   	ordernumber = getval.split("=")[1];  	
} 
window.onload=ShowMessage(); 
$(function(){
	
   	$.post("schedule.action",{"ordernumber":ordernumber},function(datas){
   		if (datas.status=="0") {
   			var userorder = datas.data.order;
			$(".user-name").html("真实姓名：&nbsp;"+userorder.realName);//姓名
			$(".user-tel").html("联系方式：&nbsp;"+userorder.phoneNumber);//手机号码
			$(".order-name").html(userorder.orderName);//订单名称
			$("#order-image").attr("src",userorder.orderImage);//订单图片
			$(".order-description").html(userorder.orderDescripe);//订单描述
			$(".order-mode").html(userorder.dsNote);//特有描述
			$(".order-number").html("订单编号：&nbsp;"+userorder.orderNumber);//订单号码
			$(".order-time").html("下单时间：&nbsp;"+userorder.orderTime);//创建订单时间
			$(".order-price").html("¥"+userorder.originalPrice+".00");//套餐原价
			$(".price-pay").html("¥"+userorder.orderPrice+".00");//实际付款
			$(".price-coupon").html("¥"+(userorder.originalPrice-userorder.orderPrice)+".00");//优惠价格
			// 订单状态值，0用户未支付；1已付款；2驾校特有，未上交材料；3驾校特有，驾校已报名，正在返还材料；4交易完成，未评价；5未付款取消订单；6已付款取消订单；7交易完成，已评价
			if (userorder.orderStatus=="0") {//用户提交订单未支付
				$(".chedule-content").html("未付款");
				$(".chedule-content").css({"color":"white","background":"orange"});
				$(".shedule-hint-text").html("您已提交订单,请尽快完成支付！");
				$(".footer").show();
				$(".toPay").show();
				$(".cancel").show();
				$(".price").css({"margin-bottom":"58px"});

				//未支付，去付款
				$(".toPay").click(function(){
					//拿到订单编号，进行判断属于那种类型，再加载不同
					var typeLetter = ordernumber.substr(0,1);//提取订单号收个字母，D驾校，V别墅，A军旅
    				var cancelUrl="";// type(1为别墅评论 2为驾校 3为军旅)
        			if (typeLetter=="V") {
            			//是别墅，需要先判断当前选择的别墅是否已经被预定
            			$.post("villaCheck",{"ordernumber":ordernumber},function(datas){
            				if (datas.status==0) {
            					window.location.href="payHint.html?ordernumber="+ordernumber;
            				}else{
            					alert(dats.msg);//您的套餐中别墅或日期已被预约
            				}
            			},"json");
        			}else{
           			 	
        			}
					
				});
				//未支付，取消订单
				$(".cancel").click(function(){
					//拿到订单编号，进行判断属于那种类型，再加载不同
					var typeLetter = ordernumber.substr(0,1);//提取订单号收个字母，D驾校，V别墅，A军旅
    				var cancelUrl="";// type(1为别墅评论 2为驾校 3为军旅)
        			if (typeLetter=="V") {
            			cancelUrl="cancelVillaOrder";
        			}else if (typeLetter=="A") {
            			cancelUrl="cancelArmyOrder";
        			}else if (typeLetter=="D") {
           			 	cancelUrl="cancelOrder.action";
        			}

					var r = confirm("确定取消本订单吗？");
					if(r == true){
						$.post(cancelUrl,{"ordernumber":ordernumber},function(datas){
							if (status==0) {
								window.location.href="orderInformation.html?ordernumber="+ordernumber;
							}else{
								// alert("系统繁忙，请稍后再试");
							}
						},"json");
					}
				});
			}else if (userorder.orderStatus=="1"||userorder.orderStatus=="2") {//1代表用户已付款,驾校特有状态值2，代表材料尚未拿过来
				$(".chedule-content").html("已付款");
				$(".chedule-content").css({"color":"white","background":"green"});
				$(".shedule-hint-text").html("订单已支付，请准备好所需材料，24小时之内将会有工作人员与您联系上门提取，请保持电话畅通。");
				$(".footer").show();
				$(".cancel").show();
				$(".price").css({"margin-bottom":"58px"});

				//已支付，取消订单，此时是退款
				$(".cancel").click(function(){
					window.location.href="ds_refund.html?ordernumber="+ordernumber;
				});
			}else if (userorder.orderStatus=="3") {//驾校特有状态值，用户报名成功
				$(".chedule-content").html("已报名");
				$(".chedule-content").css({"color":"white","background":"green"});
				$(".shedule-hint-text").html("您已完成报名，材料正在返还的路上，请注意查收。");
				$(".shedule-hint-delivery").show();//显示材料收到按钮
				//材料已送达接口，确认，将状态值由3改为4
				$(".shedule-hint-delivery").click(function(){
					$.post("changeStatus.action",{"ordernumber":ordernumber},function(obj){
						window.location.href="orderInformation.html?ordernumber="+ordernumber;//刷新当前页面
					},'json');
				});
				$('delivery').unbind("click"); //移除点击事件
			}else if (userorder.orderStatus=="4") {//订单交易完成,7已评价
				$(".chedule-content").html("交易完成");
				$(".chedule-content").css({"color":"white","background":"green"});
				$(".shedule-hint-text").html("北京漂洋过海欢迎您再次使用!");
				$(".footer").show();
				$(".assess").show();
				$(".price").css({"margin-bottom":"58px"});
				//评价,获取当前订单号，进行判断是属于哪个类型
            	$(".assess").click(function(){
                	var typeLetter = ordernumber.substr(0,1);//提取订单号收个字母，D驾校，V别墅，A军旅
                	var type="";// type(1为别墅评论 2为驾校 3为军旅)
                	if (typeLetter=="V") {
                    	type=1;
                	}else if (typeLetter=="A") {
                    	type=3;
                	}else if (typeLetter=="D") {
                    	type=2;
                	}
               	 	window.location.href="assessSet.html?type="+type+"&ordernumber="+ordernumber;
            	});
			}else if (userorder.orderStatus=="5"||userorder.orderStatus=="6") {//订单交易关闭，5付款后取消，6未付款取消
				$(".chedule-content").html("交易关闭");
				$(".chedule-content").css({"color":"white","background":"#ccc"});
				$(".shedule-hint-text").html("北京漂洋过海欢迎您再次使用!");
			}else if (userorder.orderStatus=="7") {//订单交易完成
				$(".chedule-content").html("交易完成");
				$(".chedule-content").css({"color":"white","background":"green"});
				$(".shedule-hint-text").html("北京漂洋过海欢迎您再次使用!");	
			}
   		}
   	},"json");

});
</script>
</body>
</html>